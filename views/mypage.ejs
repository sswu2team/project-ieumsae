<!--mypage.ejs-->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마이페이지</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        .change-password {
            flex: 1;
            margin-left: 20px;
        }

        .form-group {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <header>
        <img src="/img/logo.png" alt="로고" class="logo">
        <button class="btn" onclick="navigateToHome()">홈</button>
        <script>
            function navigateToHome() {
                window.location.href = "/";
            }
        </script>
        <button class="btn" onclick="navigateToDelete()">회원 탈퇴</button>
        <script>
            function navigateToDelete() {
                window.location.href = "/mypage/deletePage";
            }
        </script>
    </header>
    <div class="container">
        <div class="profile-section">
            <img src="<%= userInfo.user_profile ? userInfo.user_profile + '?v=' + new Date().getTime() : '/img/default-profile.png' %>" alt="프로필 사진" class="profile-pic">
            <h2>마이페이지</h2>
            <button class="btn" onclick="navigateToPWupdate()">비밀번호 변경</button>
            <script>
                function navigateToPWupdate() {
                    window.location.href = "/mypage/pwUpdatePage";
                }
            </script>
            <!-- 프로필 사진 변경 버튼 및 폼 추가 -->
            <button class="btn" onclick="document.getElementById('profilePicInput').click()">프로필 사진 변경</button>
            <form id="profilePicForm" enctype="multipart/form-data" style="display:none;">
                <input type="file" id="profilePicInput" name="profilePic" accept="image/*" onchange="uploadProfilePic()">
            </form>
        </div>
        <div class="diary-section"> 
            <div class="diary-container">
                <div class="diary">
                   <h3>이름: <%= userInfo.user_name %></h3>
                   <h3>아이디: <%= userInfo.user_number %></h3>
                   <h3>성별: <%= userInfo.user_gender %></h3>
                   <h3>나이: <%= userInfo.user_age %></h3>
                   <h3>이메일: <%= userInfo.user_email %></h3>
                   <h3>관심사: <%= userInfo.user_interest %></h3>
                </div>
            </div>
        </div>

    <script>
        function uploadProfilePic() {
            const formData = new FormData(document.getElementById('profilePicForm'));
            fetch('/mypage/uploadProfilePic', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('프로필 사진이 성공적으로 변경되었습니다!');
                    // 이미지 소스 업데이트
                    document.querySelector('.profile-pic').src = data.newProfilePicPath + '?v=' + new Date().getTime();
                } else {
                    alert('프로필 사진 변경에 실패했습니다.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('프로필 사진 변경 중 오류가 발생했습니다.');
            });
        }
    </script>
</body>
</html>